<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Password Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(to bottom right, #1e3a8a, #2563eb);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: sans-serif;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 1rem;
      padding: 2rem;
      width: 100%;
      max-width: 500px;
      color: white;
    }
    .hidden { display: none; }
    .dark-mode { background-color: #111827; color: #f3f4f6; }
    .dark-mode input, .dark-mode select {
      background-color: #1f2937;
      color: white;
      border-color: #374151;
    }
    .dark-mode .glass-card { background-color: rgba(31, 41, 55, 0.8); }
  </style>
</head>
<body>

<div id="container" class="glass-card">
  <div id="auth-section">
    <h2 class="text-2xl font-bold mb-4 text-center" id="auth-title">Sign Up</h2>
    <input id="email" type="email" placeholder="Email" class="w-full p-2 border mb-3 rounded text-black" />
    <input id="password" type="password" placeholder="Password" class="w-full p-2 border mb-1 rounded text-black" />
    <p class="text-xs mb-2">Password must include upper, lower, number, special character, and be 8+ chars.</p>
    <button id="auth-btn" class="bg-white text-blue-700 w-full py-2 rounded hover:bg-blue-100 font-semibold">Sign Up</button>
    <p id="toggle-auth" class="text-sm text-center mt-3">
      Already have an account? <a href="#" id="toggle-link" class="underline text-white">Log In</a>
    </p>
    <p class="text-center mt-3"><button id="toggle-darkmode" class="text-xs underline">Toggle Dark Mode</button></p>
  </div>

  <div id="dashboard" class="hidden">
    <h2 class="text-xl font-bold mb-4 text-center">Welcome, <span id="user-display"></span></h2>
    <div id="main-buttons" class="flex flex-col gap-2 mb-4">
      <button id="add-account-btn" class="bg-green-500 py-2 rounded hover:bg-green-600">‚ûï Add Account</button>
      <button id="view-accounts-btn" class="bg-yellow-500 py-2 rounded hover:bg-yellow-600">üìÇ View Accounts</button>
      <button id="export-btn" class="bg-blue-500 py-2 rounded hover:bg-blue-600">üì§ Export Vault</button>
      <label class="block">
        <input id="import-file" type="file" class="hidden" />
        <span class="bg-indigo-500 w-full text-center block py-2 rounded hover:bg-indigo-600 cursor-pointer">üì• Import Vault</span>
      </label>
      <button id="logout-btn" class="bg-gray-500 py-2 rounded hover:bg-gray-600">üö™ Logout</button>
    </div>
    <div id="home-btn-wrapper" class="hidden mb-4">
      <button id="home-btn" class="bg-white text-blue-700 py-2 w-full rounded hover:bg-blue-100 font-semibold">üè† Home</button>
    </div>
    <div id="add-form" class="hidden">
      <select id="add-account-type" class="w-full p-2 border mb-2 rounded text-black">
        <option value="">-- Select Account Type --</option>
        <option>Gmail/Google</option>
        <option>Outlook</option>
        <option>Yahoo</option>
        <option>Yandex</option>
        <option>Facebook</option>
        <option>Instagram</option>
        <option>Twitter</option>
        <option>Ask.fm</option>
        <option value="__custom__">‚ûï Custom Type</option>
      </select>
      <input id="custom-account-type" type="text" placeholder="Custom account type" class="hidden w-full p-2 border mb-2 rounded text-black" />
      <input id="add-username" type="text" placeholder="Username" class="w-full p-2 border mb-2 rounded text-black" />
      <input id="add-emailphone" type="email" placeholder="Email" class="w-full p-2 border mb-2 rounded text-black" />
      <input id="add-password" type="text" placeholder="Password" class="w-full p-2 border mb-2 rounded text-black" />
      <input id="add-remarks" type="text" placeholder="Remarks (optional)" class="w-full p-2 border mb-2 rounded text-black" />
      <button id="save-account-btn" class="bg-white text-blue-700 w-full py-2 rounded hover:bg-blue-100 font-semibold">Save</button>
    </div>
    <div id="view-section" class="hidden">
      <select id="show-account-type" class="w-full p-2 border mb-2 rounded text-black"></select>
      <select id="show-username" class="w-full p-2 border mb-2 rounded text-black hidden" disabled></select>
      <div id="account-info" class="account-info hidden p-3 rounded border bg-white text-black">
        <p><strong>Email:</strong> <span id="info-emailphone"></span></p>
        <p><strong>Password:</strong> <span id="info-password"></span></p>
        <p><strong>Remarks:</strong> <span id="info-remarks"></span></p>
      </div>
      <button id="delete-account-btn" class="hidden bg-red-500 w-full text-white py-2 mt-2 rounded hover:bg-red-700">Delete Account</button>
    </div>
  </div>

  <p class="text-xs text-center mt-6 text-white opacity-80">Developed by <strong>Nur</strong></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
(() => {
  const $ = id => document.getElementById(id);
  let isSignup = true, masterKey = null, currentUser = null;

  const toggleDark = () => {
    const next = !(localStorage.getItem('darkMode') === 'true');
    localStorage.setItem('darkMode', next);
    document.body.classList.toggle('dark-mode', next);
  };
  $('toggle-darkmode').onclick = toggleDark;
  document.body.classList.toggle('dark-mode', localStorage.getItem('darkMode') === 'true');

  const getUsers = () => JSON.parse(localStorage.getItem('users') || '{}');
  const saveUsers = u => localStorage.setItem('users', JSON.stringify(u));
  const getSalt = u => localStorage.getItem(u + '_salt');
  const setSalt = (u, s) => localStorage.setItem(u + '_salt', s);
  const deriveKey = (p, s) => CryptoJS.PBKDF2(p, CryptoJS.enc.Hex.parse(s), { keySize: 256 / 32, iterations: 1000 }).toString();
  const encryptVault = d => CryptoJS.AES.encrypt(JSON.stringify(d), masterKey).toString();
  const decryptVault = c => { try { return JSON.parse(CryptoJS.AES.decrypt(c, masterKey).toString(CryptoJS.enc.Utf8)); } catch { return []; } };
  const loadVault = () => { const c = localStorage.getItem(currentUser + '_vault'); return c ? decryptVault(c) : []; };
  const saveVault = v => localStorage.setItem(currentUser + '_vault', encryptVault(v));
  const validatePassword = p => /[A-Z]/.test(p) && /[a-z]/.test(p) && /[0-9]/.test(p) && /[^A-Za-z0-9]/.test(p) && p.length >= 8;

  $('toggle-link').onclick = e => {
    e.preventDefault();
    isSignup = !isSignup;
    $('auth-title').textContent = isSignup ? 'Sign Up' : 'Log In';
    $('auth-btn').textContent = isSignup ? 'Sign Up' : 'Log In';
    $('toggle-auth').innerHTML = isSignup
      ? 'Already have an account? <a href="#" id="toggle-link" class="underline text-white">Log In</a>'
      : 'Don‚Äôt have an account? <a href="#" id="toggle-link" class="underline text-white">Sign Up</a>';
    setTimeout(() => $('toggle-link').onclick = arguments.callee, 0);
  };

  $('auth-btn').onclick = () => {
    const email = $('email').value.trim(), pw = $('password').value;
    if (!email || !pw) return Swal.fire('Error','Fill all fields','error');
    if (!validatePassword(pw)) return Swal.fire('Error','Weak password','error');
    const users = getUsers();

    if (isSignup) {
      if (users[email]) return Swal.fire('Error','Email exists','error');
      const salt = CryptoJS.lib.WordArray.random(128/8).toString();
      setSalt(email, salt);
      users[email] = CryptoJS.SHA256(pw + salt).toString();
      saveUsers(users);
      Swal.fire('Signed up','Now log in','success').then(() => $('toggle-link').click());
    } else {
      const salt = getSalt(email);
      if (!salt || users[email] !== CryptoJS.SHA256(pw + salt).toString())
        return Swal.fire('Error','Invalid credentials','error');
      masterKey = deriveKey(pw, salt);
      currentUser = email;
      $('auth-section').classList.add('hidden');
      $('dashboard').classList.remove('hidden');
      $('user-display').textContent = email;
      $('email').value = '';
      $('password').value = '';
    }
  };

  $('logout-btn').onclick = () => location.reload();
  $('home-btn').onclick = () => hideAllViews();
  $('add-account-btn').onclick = () => showOnly('add-form');
  $('view-accounts-btn').onclick = () => { showOnly('view-section'); populateTypes(); };

  function showOnly(id) {
    $('main-buttons').classList.add('hidden');
    $('home-btn-wrapper').classList.remove('hidden');
    $('add-form').classList.add('hidden');
    $('view-section').classList.add('hidden');
    $(id).classList.remove('hidden');
  }

  function hideAllViews() {
    $('main-buttons').classList.remove('hidden');
    $('home-btn-wrapper').classList.add('hidden');
    $('add-form').classList.add('hidden');
    $('view-section').classList.add('hidden');
    $('account-info').classList.add('hidden');
    $('delete-account-btn').classList.add('hidden');
  }

  $('add-account-type').onchange = () => {
    $('custom-account-type').classList.toggle('hidden', $('add-account-type').value !== '__custom__');
  };
  $('save-account-btn').onclick = () => {
    const type = $('add-account-type').value === '__custom__' ? $('custom-account-type').value.trim() : $('add-account-type').value;
    const un = $('add-username').value.trim();
    const em = $('add-emailphone').value.trim();
    const pw = $('add-password').value.trim();
    const rm = $('add-remarks').value.trim();
    if (!type || !un || !em || !pw) return Swal.fire('Error','Fill required','error');
    let vault = loadVault();
    if (vault.find(a=>a.accountType===type && a.username===un))
      return Swal.fire('Error','Duplicate','error');
    vault.push({accountType:type,username:un,emailphone:em,password:pw,remarks:rm});
    saveVault(vault);
    Swal.fire('Saved','Account added','success');
    $('add-account-type').value = '';
    $('custom-account-type').classList.add('hidden');
    $('custom-account-type').value = '';
    $('add-username').value = '';
    $('add-emailphone').value = '';
    $('add-password').value = '';
    $('add-remarks').value = '';
  };

  function populateTypes() {
    const types = [...new Set(loadVault().map(a => a.accountType))];
    $('show-account-type').innerHTML = "<option value=''>-- Select Account Type --</option>" + types.map(t=>`<option>${t}</option>`).join('');
  }

  $('show-account-type').onchange = () => {
    const sel = $('show-account-type').value;
    const vault = loadVault().filter(a=>a.accountType===sel);
    $('show-username').innerHTML = "<option>-- Select Username --</option>" + vault.map(a=>`<option>${a.username}</option>`).join('');
    $('show-username').disabled = !vault.length;
    $('show-username').classList.toggle('hidden', !vault.length);
    $('account-info').classList.add('hidden');
    $('delete-account-btn').classList.add('hidden');
  };

  $('show-username').onchange = () => {
    const acc = loadVault().find(a=>a.accountType===$('show-account-type').value && a.username===$('show-username').value);
    if (!acc) return;
    $('info-emailphone').textContent = acc.emailphone;
    $('info-password').textContent = acc.password;
    $('info-remarks').textContent = acc.remarks || '(none)';
    $('account-info').classList.remove('hidden');
    $('delete-account-btn').classList.remove('hidden');
  };

  $('delete-account-btn').onclick = async () => {
    const { value: pwd } = await Swal.fire({
      title: 'Confirm Deletion',
      input: 'password',
      inputLabel: 'Master Password',
      showCancelButton: true
    });
    if (!pwd) return;
    if (CryptoJS.SHA256(pwd + getSalt(currentUser)).toString() !== getUsers()[currentUser]) {
      return Swal.fire('Error','Incorrect password','error');
    }
    let vault = loadVault();
    vault = vault.filter(a => !(a.accountType === $('show-account-type').value && a.username === $('show-username').value));
    saveVault(vault);
    Swal.fire('Deleted','Account removed','success');
    $('account-info').classList.add('hidden');
    $('delete-account-btn').classList.add('hidden');
  };

  $('export-btn').onclick = () => {
    const blob = new Blob([encryptVault(loadVault())], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = currentUser + '_vault.json';
    a.click();
    URL.revokeObjectURL(a.href);
  };
  $('import-file').onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        decryptVault(reader.result);
        localStorage.setItem(currentUser + '_vault', reader.result);
        populateTypes();
        Swal.fire('Imported','Vault loaded','success');
      } catch {
        Swal.fire('Error','Invalid file','error');
      }
    };
    reader.readAsText(file);
  };
})();

(() => {
  const $ = id => document.getElementById(id);
  let isSignup = true, currentUser = null;

  const toggleDark = () => {
    const next = !(localStorage.getItem('darkMode') === 'true');
    localStorage.setItem('darkMode', next);
    document.body.classList.toggle('dark-mode', next);
  };
  $('toggle-darkmode').onclick = toggleDark;
  document.body.classList.toggle('dark-mode', localStorage.getItem('darkMode') === 'true');

  const getUsers = () => JSON.parse(localStorage.getItem('users') || '{}');
  const saveUsers = u => localStorage.setItem('users', JSON.stringify(u));

  const loadVault = () => JSON.parse(localStorage.getItem(currentUser + '_vault') || '[]');
  const saveVault = v => localStorage.setItem(currentUser + '_vault', JSON.stringify(v));

  const validatePassword = p => /[A-Z]/.test(p) && /[a-z]/.test(p) && /[0-9]/.test(p) && /[^A-Za-z0-9]/.test(p) && p.length >= 8;

  $('toggle-link').onclick = e => {
    e.preventDefault();
    isSignup = !isSignup;
    $('auth-title').textContent = isSignup ? 'Sign Up' : 'Log In';
    $('auth-btn').textContent = isSignup ? 'Sign Up' : 'Log In';
    $('toggle-auth').innerHTML = isSignup
      ? 'Already have an account? <a href="#" id="toggle-link" class="underline text-white">Log In</a>'
      : 'Don‚Äôt have an account? <a href="#" id="toggle-link" class="underline text-white">Sign Up</a>';
    setTimeout(() => $('toggle-link').onclick = arguments.callee, 0);
  };

  $('auth-btn').onclick = () => {
    const email = $('email').value.trim(), pw = $('password').value;
    if (!email || !pw) return Swal.fire('Error','Fill all fields','error');
    if (!validatePassword(pw)) return Swal.fire('Error','Weak password','error');
    const users = getUsers();

    if (isSignup) {
      if (users[email]) return Swal.fire('Error','Email exists','error');
      users[email] = pw; // save plain password just for demo
      saveUsers(users);
      Swal.fire('Signed up','Now log in','success').then(() => $('toggle-link').click());
    } else {
      if (!users[email] || users[email] !== pw)
        return Swal.fire('Error','Invalid credentials','error');
      currentUser = email;
      $('auth-section').classList.add('hidden');
      $('dashboard').classList.remove('hidden');
      $('user-display').textContent = email;
      $('email').value = '';
      $('password').value = '';
    }
  };

  $('logout-btn').onclick = () => location.reload();
  $('home-btn').onclick = () => hideAllViews();
  $('add-account-btn').onclick = () => showOnly('add-form');
  $('view-accounts-btn').onclick = () => { showOnly('view-section'); populateTypes(); };

  function showOnly(id) {
    $('main-buttons').classList.add('hidden');
    $('home-btn-wrapper').classList.remove('hidden');
    $('add-form').classList.add('hidden');
    $('view-section').classList.add('hidden');
    $(id).classList.remove('hidden');
  }

  function hideAllViews() {
    $('main-buttons').classList.remove('hidden');
    $('home-btn-wrapper').classList.add('hidden');
    $('add-form').classList.add('hidden');
    $('view-section').classList.add('hidden');
    $('account-info').classList.add('hidden');
    $('delete-account-btn').classList.add('hidden');
  }

  $('add-account-type').onchange = () => {
    $('custom-account-type').classList.toggle('hidden', $('add-account-type').value !== '__custom__');
  };
  $('save-account-btn').onclick = () => {
    const type = $('add-account-type').value === '__custom__' ? $('custom-account-type').value.trim() : $('add-account-type').value;
    const un = $('add-username').value.trim();
    const em = $('add-emailphone').value.trim();
    const pw = $('add-password').value.trim();
    const rm = $('add-remarks').value.trim();
    if (!type || !un || !em || !pw) return Swal.fire('Error','Fill required','error');
    let vault = loadVault();
    if (vault.find(a=>a.accountType===type && a.username===un))
      return Swal.fire('Error','Duplicate','error');
    vault.push({accountType:type,username:un,emailphone:em,password:pw,remarks:rm});
    saveVault(vault);
    Swal.fire('Saved','Account added','success');
    $('add-account-type').value = '';
    $('custom-account-type').classList.add('hidden');
    $('custom-account-type').value = '';
    $('add-username').value = '';
    $('add-emailphone').value = '';
    $('add-password').value = '';
    $('add-remarks').value = '';
  };

  function populateTypes() {
    const types = [...new Set(loadVault().map(a => a.accountType))];
    $('show-account-type').innerHTML = "<option value=''>-- Select Account Type --</option>" + types.map(t=>`<option>${t}</option>`).join('');
  }

  $('show-account-type').onchange = () => {
    const sel = $('show-account-type').value;
    const vault = loadVault().filter(a=>a.accountType===sel);
    $('show-username').innerHTML = "<option>-- Select Username --</option>" + vault.map(a=>`<option>${a.username}</option>`).join('');
    $('show-username').disabled = !vault.length;
    $('show-username').classList.toggle('hidden', !vault.length);
    $('account-info').classList.add('hidden');
    $('delete-account-btn').classList.add('hidden');
  };

  $('show-username').onchange = () => {
    const acc = loadVault().find(a=>a.accountType===$('show-account-type').value && a.username===$('show-username').value);
    if (!acc) return;
    $('info-emailphone').textContent = acc.emailphone;
    $('info-password').textContent = acc.password;
    $('info-remarks').textContent = acc.remarks || '(none)';
    $('account-info').classList.remove('hidden');
    $('delete-account-btn').classList.remove('hidden');
  };

  $('delete-account-btn').onclick = () => {
    let vault = loadVault();
    vault = vault.filter(a => !(a.accountType === $('show-account-type').value && a.username === $('show-username').value));
    saveVault(vault);
    Swal.fire('Deleted','Account removed','success');
    $('account-info').classList.add('hidden');
    $('delete-account-btn').classList.add('hidden');
  };

  $('export-btn').onclick = () => {
    const blob = new Blob([JSON.stringify(loadVault(), null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = currentUser + '_vault.json';
    a.click();
    URL.revokeObjectURL(a.href);
  };

  $('import-file').onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const data = JSON.parse(reader.result);
        if (!Array.isArray(data)) throw new Error();
        saveVault(data);
        populateTypes();
        Swal.fire('Imported', 'Vault loaded', 'success');
      } catch {
        Swal.fire('Error', 'Invalid vault file format', 'error');
      }
    };
    reader.readAsText(file);
  };
})();

</script>
</body>
</html>
